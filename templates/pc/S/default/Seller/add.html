<link href="__H__/css/plugins/steps/jquery.steps.css" rel="stylesheet">
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>创建商户</h5>
                </div>
                <div class="ibox-content">
                    <form id="wizard" name="sellerForm" method="post" class="form-horizontal" action="">
                        <h1>创建登录账号</h1>
                        <fieldset>
                            <div class="col-sm-8">
                                <div class="form-group">
                                    <label>登录名</label>
                                    <input type="text" class="form-control" name="username" placeholder="用户名，可用于登录" required>
                                </div>

                                <div class="form-group">
                                    <label>手机号码</label>
                                        <input type="text" class="form-control required" name="mobile" placeholder="绑定手机号码，可用于登录">
                                </div>

                                <div class="form-group">
                                    <label>邮箱</label>
                                    <input type="text" class="form-control required" name="email" placeholder="绑定邮箱，可用于登录" email="true">
                                </div>

                                <div class="form-group">
                                    <label>登录密码</label>
                                    <input type="password" id="password" class="form-control required" name="password" placeholder="请输入密码">
                                </div>

                                <div class="form-group">
                                    <label>确认密码</label>
                                    <input type="password" class="form-control required" name="confirm_password" placeholder="请再次输入密码">
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="text-center">
                                    <div style="margin-top: 70px">
                                        <i class="fa fa-sign-in" style="font-size: 180px;color: #e5e5e5 "></i>
                                        <p>请认真填写账户登录信息</p>
                                    </div>
                                </div>
                            </div>
                        </fieldset>

                        <h1>设置基本信息</h1>
                        <fieldset>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">商户名称</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control" name="seller_name" placeholder="如：无味真火" required>
                                </div>
                            </div>

                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">公司名称</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control" name="company_name" placeholder="如：湖北德胜餐饮有限公司">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label">座机号码</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control" name="contacts_phone" placeholder="如：0713 8667123">
                                </div>
                            </div>

                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">收款账号</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control" name="settlement_account" placeholder="请填写支付宝账号">
                                </div>
                            </div>

                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">收款银行卡信息</label>
                                <div class="col-sm-5">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">开户行</span>
                                        <input type="text" name="bank_name" class="form-control" placeholder="如：中国工商银行">
                                    </div>
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">开户人</span>
                                        <input type="text" name="bank_user_name" class="form-control" placeholder="请填写您的开户姓名">
                                    </div>
                                    <div class="input-group">
                                        <span class="input-group-addon">卡　号</span>
                                        <input type="text" name="bank_card" class="form-control" placeholder="请填写您的银行卡号">
                                    </div>
                                </div>
                            </div>

                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">联系人手机号码</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control" name="contacts_mobile" placeholder="如：15997152146">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label">联系人邮箱</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control" name="contacts_email" placeholder="如：811800545@qq.com">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label">商户联系人姓名</label>
                                <div class="col-sm-5">
                                    <input type="text" class="form-control" name="contacts_name" placeholder="如：夏凯">
                                </div>
                            </div>

                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">商户简介</label>
                                <div class="col-sm-5">
                                    <textarea type="textarea" class="form-control" name="describe" placeholder="如：湖北德胜餐饮有限公司成立于2014年……"></textarea>
                                </div>
                            </div>

                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">状态</label>
                                <div class="col-sm-5">
                                    <input type="checkbox" class="js-switch" name="status" value="1" />
                                </div>
                            </div>

                        </fieldset>

                        <h1>上传资料</h1>
                        <fieldset>
                            <div class="form-group">
                                <input type="hidden" name="logo" value="" />
                                <label class="col-sm-2 control-label">商户logo</label>
                                <div class="col-sm-6">
                                    <div class="uploader-list" id="fileList_logo"></div>
                                    <div id="filePicker_logo" class="filePicker"><i class="fa fa-cloud-upload"></i></div>
                                    <span class="col-sm-12 help-block m-b-none"><i class="fa fa-info-circle"></i>&nbsp;请务必上传等比例图片，建议100*100像素</span>
                                </div>
                            </div>

                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <input type="hidden" name="paper_img" value="" />
                                <label class="col-sm-2 control-label">法人执证件照片</label>
                                <div class="col-sm-6">
                                    <div class="uploader-list" id="fileList_paper_img"></div>
                                    <div id="filePicker_paper_img" class="filePicker"><i class="fa fa-cloud-upload"></i></div>
                                    <span class="col-sm-12 help-block m-t m-b-none alert alert-warning">请务清晰图片</span>
                                </div>
                            </div>
                        </fieldset>

                        <h1>确认信息</h1>
                        <fieldset>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">商户名称</label>
                                <label class="col-sm-2 control-label">商户名称</label>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label">商户名称</label>
                                <label class="col-sm-2 control-label">商户名称</label>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label">注册条款</label>
                                <div class="col-sm-5">
                                    <input id="acceptTerms" name="acceptTerms" type="checkbox">
                                    <label for="acceptTerms">我同意注册条款</label>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="__H__/js/content.min.js?v=1.0.0"></script>
<script src="__PUBLIC__/js/webuploader/uploader.js"></script>
<script src="__H__/js/plugins/staps/jquery.steps.min.js"></script>
<script src="__H__/js/plugins/validate/jquery.validate.min.js"></script>
<script src="__H__/js/plugins/validate/messages_zh.min.js"></script>
<style>
    .wizard > .content {
        min-height: 420px;
    }
    .hr-line-dashed {
        background-color: #C7C7C7;
    }
    .wizard > .content > .body {
        position: relative;
        width: 100%;
    }
</style>

<script>
    layer_index = new Array;

$(function(){
    $("#wizard").steps({
        bodyTag: "fieldset",
        onStepChanging: function(event, currentIndex, newIndex) {
            // “向后”不需要验证
            if (currentIndex > newIndex) {
                return true;
            }
            var form = $(this);
            // 初始化，清除错误显示，还原样式
            if (currentIndex < newIndex) {
                // layer.closeAll('tips');
                $(".body:eq(" + newIndex + ") label.error", form).remove();
                $(".body:eq(" + newIndex + ") .error", form).removeClass("error")
            }
            form.validate().settings.ignore = ":disabled,:hidden";
            return form.valid()
        },
        onStepChanged: function(event, currentIndex, priorIndex) {

        },
        onFinishing: function(event, currentIndex) {
            var form = $(this);
            form.validate().settings.ignore = ":disabled";
            return form.valid()
        },
        onFinished: function(event, currentIndex) {
            var form = $(this);
            form.submit()
        }
    }).validate({
        errorPlacement: function(error, element) {
            // var id = element.attr('name');
            // if (layer_index[id] || error.html() == '') {
            //     layer.close(layer_index[id]);
            // }
            // layer_index[id] = layer.tips(error.html(), element, {
            //     id: id,
            //     tips: [2, '#ED5565'],
            //     tipsMore: true,
            //     time: false
            // });

            element.before(error);
             // error.appendTo(element.parent());
        },
        rules: {
            confirm_password: {
                equalTo: "#password"
            },
            acceptTerms: {
                required: true,
            },
        },
        messages: {
            acceptTerms: {
                required: function(){layer.msg('请先阅读并同意入驻协议条款');return false;},
            },
            confirm_password: {
                equalTo: "两次密码输入不一致",
            }
        }
    });

    new Switchery(document.querySelector(".js-switch"), {color: "#1AB394"});
    $(".i-checks").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",});

    $("#filePicker_logo").uploader({
        server:'{:U("seller/img_upload?file=logo")}',
        filelist:"#fileList_logo",
        fileVal:'logo',
        uploaded:function(result){
            $("input[name='logo']").val(result.url.slice(1));
        },
    });

    $("#filePicker_paper_img").uploader({
        server:'{:U("seller/img_upload?file=paper_img")}',
        filelist:"#fileList_paper_img",
        fileVal:'paper_img',
        uploaded:function(result){
            $("input[name='paper_img']").val(result.url.slice(1));
        },
    });

    $("form[name=sellerForm]").submit(function(){
        // return true;
        $.post("{:U('add')}", $(this).serialize(), function(result){
            if (result.status == 1) {
                alert(result.info);
                window.location.href = result.url;
            } else {
                alert(result.info);
            }
        });
        return false;
        // 不采用令牌的方案无法从根本上解决重复提交（多次提交）的问题，也无法阻止攻击者通过蓄意构造的欺诈请求的攻击
    });
});
</script>